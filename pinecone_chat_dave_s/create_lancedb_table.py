import lancedb
import pyarrow as pa
import pandas as pd

# Connect to the database
uri = "/tmp/sample-lancedb"
db = lancedb.connect(uri)

schema = pa.schema([
    pa.field("unique_id", pa.string()),
    pa.field("embedded_user_input", pa.list_(pa.list_(pa.float32()))),
    pa.field("metadata", pa.struct([
        pa.field("message", pa.string()),
        pa.field("speaker", pa.string()),
        pa.field("time", pa.float64()),
        pa.field("timestring", pa.string()),
        pa.field("uuid", pa.string())
    ]))
])

# Create the table with the defined schema
table_name = "lance-table"
if table_name in db.table_names():
    db.drop_table(table_name)  # Drop the table if it already exists

tbl = db.create_table(table_name, schema=schema)

# Insert the provided data into the table
data = {
    'unique_id': '954a51d7-8ac8-4b24-8d56-612e63ff15fb',
    'embedded_user_input': [[-6.26545027e-02, -6.17343448e-02,  5.13638668e-02,
        -2.15298426e-03,  6.47769943e-02, -5.32028712e-02,
        -6.60635531e-02, -3.18052359e-02, -7.25502372e-02,
         8.14180169e-03,  7.64630958e-02,  7.56798983e-02,
        -4.16797139e-02,  8.12164322e-03,  2.48537250e-02,
         5.01681454e-02,  6.32003173e-02, -6.87251166e-02,
         6.88732713e-02, -5.29278964e-02, -3.98336835e-02,
        -2.24619396e-02,  6.21254696e-03,  6.02457719e-03,
        -3.04912337e-05,  4.78344224e-02,  4.24719378e-02,
         1.55452816e-02, -5.47493547e-02,  9.00838431e-03,
         6.09557740e-02,  3.96770723e-02, -1.97340697e-02,
        -2.08682027e-02,  4.31839637e-02, -5.55636436e-02,
         6.30072085e-03, -2.54710689e-02,  1.57420635e-02,
        -5.81943579e-02,  5.57490699e-02, -3.01882587e-02,
        -2.16408260e-02,  4.52772006e-02, -8.47738385e-02,
        -3.32002342e-02, -1.52017135e-04,  6.10890649e-02,
         3.87536660e-02, -1.94792040e-02,  8.70911554e-02,
         8.86067227e-02,  3.49610522e-02,  7.67428428e-03,
        -2.34412830e-02,  4.17789407e-02, -1.32130338e-02,
         1.38202857e-03, -4.92214859e-02, -6.16745465e-02,
        -5.19866794e-02, -7.64950588e-02, -2.83730943e-02,
        -6.44062757e-02,  2.43161842e-02, -1.89856961e-02,
        -3.92607376e-02,  6.24855123e-02, -6.58661798e-02,
         4.45577130e-02, -5.86516522e-02, -3.96902673e-02,
        -1.52153037e-02, -2.17174198e-02,  3.74496356e-02,
        -1.65620521e-02,  4.83789034e-02, -1.57914069e-02,
         3.10944263e-02,  5.05946614e-02,  2.59266607e-03,
         3.32262553e-02, -8.67186673e-03, -7.76251452e-03,
        -5.36308028e-02, -3.72965150e-02,  4.43223724e-03,
        -2.27497462e-02, -2.21967441e-03,  5.01658709e-04,
        -2.42421497e-02,  1.36928298e-02, -4.76891249e-02,
         7.97025338e-02, -3.50321233e-02, -4.04987223e-02,
        -4.54532690e-02, -1.28967864e-02,  4.91136014e-02,
        -7.35521242e-02,  4.71541584e-02, -6.14574067e-02,
        -7.49642402e-02, -6.87192893e-03, -3.81468870e-02,
        -3.45312506e-02,  6.79960325e-02, -4.25949283e-02,
         3.67511585e-02, -5.19936858e-03,  4.17536497e-03,
        -5.79770480e-04, -4.82287556e-02, -5.12428135e-02,
         4.06234413e-02,  8.19317345e-03, -3.30924615e-02,
         3.97548154e-02, -2.01502815e-02, -7.69829825e-02,
         1.03119072e-02,  4.01838385e-02, -2.14411654e-02,
        -3.10645811e-03, -3.35901007e-02,  3.87730636e-02,
         4.81218584e-02,  3.33287269e-02,  6.81211650e-02,
        -2.04943419e-02,  5.63151669e-03,  6.00613914e-02,
        -5.66559546e-02,  3.37162614e-02, -1.73472352e-02,
         6.10585660e-02, -8.43226537e-03, -2.21500266e-02,
         4.09952849e-02, -1.46842571e-02,  7.34459050e-03,
        -3.81853282e-02,  7.09644631e-02, -5.92554510e-02,
         4.73418506e-03, -3.16169150e-02,  4.51507978e-02,
        -1.32356370e-02, -7.91342650e-03, -6.76603466e-02,
        -2.19407026e-02, -4.68791090e-02, -3.35567333e-02,
        -9.19987273e-04, -3.93564962e-02,  6.74620830e-03,
         1.05946194e-02, -3.96276303e-02,  5.13323732e-02,
         6.83040172e-02, -5.59230559e-02, -3.87670770e-02,
         4.26476151e-02,  1.18510174e-02, -6.79494292e-02,
        -2.71163080e-02, -4.61316220e-02, -2.41160076e-02,
         2.34598271e-03, -3.99308512e-03, -5.53577878e-02,
         1.51954480e-02,  1.42454393e-02, -3.71248787e-03,
        -4.11541760e-02,  2.50568427e-02, -1.15930280e-02,
         5.77302836e-02,  3.23428623e-02,  3.74678262e-02,
         7.69987181e-02,  1.31112942e-02, -4.07879986e-02,
        -4.81924741e-03, -3.93562727e-02,  4.73114438e-02,
        -2.02127416e-02, -1.57226510e-02,  2.18385682e-02,
         7.14582279e-02, -1.11324033e-02,  6.35397434e-02,
         3.72483805e-02,  7.68801803e-03,  6.50668740e-02,
         1.46127986e-02,  1.64960064e-02,  6.61863834e-02,
         7.23002329e-02,  2.75923219e-02, -4.38374653e-02,
         2.13374514e-02, -7.04232827e-02,  8.42249542e-02,
        -3.94568639e-03, -1.17944321e-02,  2.36889012e-02,
         8.66850466e-02, -7.39033520e-02,  2.15587541e-02,
         3.52543704e-02,  8.93795788e-02,  5.42501360e-02,
         3.31024593e-03,  2.50301952e-03,  6.62300959e-02,
        -3.79833840e-02,  7.60603398e-02, -6.54230500e-03,
        -4.43211421e-02,  7.80377015e-02, -3.97722274e-02,
         5.18550314e-02, -3.09128538e-02,  1.53190056e-02,
        -5.93643598e-02, -3.69574539e-02, -6.92243427e-02,
        -2.22874433e-02, -3.23781446e-02,  2.22802069e-02,
         2.45760716e-02,  5.31888232e-02,  7.27956295e-02,
         5.55619411e-02, -6.03345521e-02,  3.58165316e-02,
         6.69000149e-02,  2.63721589e-02,  1.91009603e-02,
        -1.16844280e-02, -4.99990620e-02,  3.77958380e-02,
         4.03854139e-02, -9.94629227e-03,  6.78341761e-02,
         2.35567279e-02,  2.58196965e-02, -8.80458131e-02,
        -7.12908758e-03,  1.12213036e-02, -2.64896336e-03,
        -5.26964106e-02, -3.29557583e-02, -7.95157999e-02,
         5.94479367e-02, -5.27230166e-02, -5.90907447e-02,
         1.59120951e-02,  2.45965142e-02, -2.67566498e-02,
         5.75914308e-02, -7.28787407e-02,  1.15116527e-02,
         1.23289870e-02,  6.35065883e-02,  4.44619134e-02,
        -8.39941204e-02, -2.16927063e-02,  2.35904194e-02,
        -7.08061159e-02, -2.13977713e-02,  4.14545052e-02,
        -6.32385015e-02,  1.25243757e-02,  3.45105454e-02,
         5.97908460e-02,  1.73583124e-02,  6.37128502e-02,
        -5.69128012e-03,  7.65267909e-02, -9.17969458e-03,
         1.25115225e-02,  6.05608989e-03,  7.15736905e-03,
        -2.88676023e-02,  4.63359542e-02,  5.11857346e-02,
         6.64551631e-02, -3.90927382e-02,  9.19730216e-03,
        -4.83568460e-02,  8.18757340e-02, -5.08898273e-02,
         8.55021626e-02,  4.15789261e-02,  2.55660247e-02,
         2.67120358e-02, -8.67374390e-02,  1.26434006e-02,
        -4.34153043e-02, -6.69072196e-02,  6.79860786e-02,
        -6.08267151e-02, -2.35786214e-02,  1.69076547e-02,
        -2.84800697e-02,  1.13160312e-02, -1.62039232e-02,
         4.42064069e-02, -5.53385951e-02, -3.81570077e-03,
         2.24948898e-02,  2.98899561e-02, -6.20845780e-02,
        -6.17455505e-02, -2.87463143e-02, -3.64922471e-02,
         5.56914695e-02,  7.95278028e-02, -1.64140295e-02,
        -5.72730415e-02,  3.82489408e-04, -2.57991944e-02,
         5.60569996e-03,  6.22320324e-02,  2.92927753e-02,
        -2.76302639e-02,  5.42509044e-03,  4.91438694e-02,
        -2.97841169e-02,  3.85531015e-03,  3.21140550e-02,
         1.09126046e-02, -1.52886398e-02,  7.71117955e-02,
        -6.65674731e-02, -7.65100196e-02,  3.16813476e-02,
         5.35872988e-02, -2.57881954e-02, -6.31789267e-02,
         5.57179302e-02, -8.23376887e-03, -7.92930350e-02,
        -4.40230593e-03, -5.85862808e-02, -6.32085651e-02,
        -8.10343958e-03, -5.15765324e-02, -2.71225045e-03,
         3.32846702e-03,  5.35010137e-02, -4.46226373e-02,
        -4.61465903e-02, -2.83273160e-02, -8.38251561e-02,
         6.31373450e-02,  1.23920869e-02,  1.98571309e-02,
        -7.98500329e-02, -1.68409124e-02,  2.86983363e-02,
         2.83484329e-02,  1.70254000e-02, -1.03149433e-02,
        -8.28676149e-02, -7.52873644e-02, -4.72270921e-02,
         5.82849793e-02, -5.04208123e-03, -3.92815378e-03,
         8.53977427e-02, -1.49699987e-03,  2.38903500e-02,
        -7.68914223e-02,  5.22340983e-02, -1.59574747e-02,
         2.54432089e-03, -1.50677897e-02,  6.97852895e-02,
         5.79821654e-02,  4.63780463e-02,  3.72213572e-02,
        -3.19544636e-02,  3.63650844e-02, -4.67306674e-02,
         5.98343126e-02, -2.29402445e-02, -4.67077307e-02,
        -8.00297186e-02, -1.26998993e-02,  2.56194659e-02,
        -6.39827969e-03, -5.27175479e-02,  4.41791452e-02,
         2.07807161e-02,  5.10299467e-02, -3.88649292e-02,
         6.98654428e-02,  5.54772615e-02, -4.06775996e-02,
        -1.49299689e-02,  5.13479002e-02,  3.84946503e-02,
         1.78945418e-02, -5.63011244e-02, -5.97835295e-02,
         1.24690228e-03, -8.77592154e-03, -4.92253341e-02,
         3.83765349e-04, -2.30280682e-02,  7.10660294e-02,
        -1.28777493e-02, -4.60018255e-02,  5.83525524e-02,
         3.25961038e-02, -2.05171090e-02, -1.56963039e-02,
         1.95313152e-02,  5.64142177e-03,  1.13158012e-02,
         5.84767759e-02, -1.81002431e-02,  2.62346156e-02,
        -3.32502611e-02, -1.64813083e-02, -8.57450217e-02,
         3.13260332e-02,  3.87504622e-02, -2.57722810e-02,
        -1.89087894e-02,  1.56725347e-02,  6.03394490e-03,
         3.08556147e-02, -5.16294464e-02, -5.25516830e-02,
        -3.99849378e-02, -4.20687310e-02, -6.64841011e-03,
         7.83206802e-03, -2.29631155e-03, -4.14290838e-02,
         2.91460901e-02,  4.47873026e-02, -5.29750437e-02,
         2.25053560e-02, -6.13352172e-02, -7.50476914e-03,
        -1.49205895e-02,  4.77827415e-02,  6.08104430e-02,
         8.11247900e-02,  1.96281392e-02, -6.48709610e-02,
        -6.87319636e-02, -1.14012016e-02, -4.04270664e-02,
        -3.42179798e-02,  6.87915683e-02,  5.35876490e-02,
         4.46084142e-03, -4.84818779e-02,  5.91844507e-02,
         2.33293306e-02, -7.96549395e-02, -3.17407213e-02,
         4.09828983e-02,  6.81246258e-03,  1.70317590e-02,
        -1.71925023e-03,  8.94005746e-02, -5.65080382e-02,
         1.46399550e-02,  4.28286903e-02,  3.34352069e-02,
        -8.28326214e-03, -1.37287956e-02, -2.78198384e-02,
         6.07999079e-02,  1.84377236e-03,  6.71126917e-02,
         6.33158535e-02,  2.15608478e-02,  1.00288279e-02,
        -2.54965909e-02, -2.83711799e-03, -4.46973555e-02,
        -6.35108277e-02,  1.86707955e-02,  3.73574868e-02,
         3.18180919e-02,  7.15093836e-02,  5.89598902e-02,
         1.73684098e-02,  4.42634113e-02,  2.29667462e-02,
        -2.11545546e-02, -7.64802238e-03,  2.07077265e-02,
         1.67652294e-02, -8.14392939e-02,  6.16908409e-02,
         1.29615352e-03,  1.45034026e-02, -5.27655222e-02,
        -7.53152221e-02,  3.42715979e-02,  4.82611544e-02,
        -2.72559226e-02, -6.31448776e-02]],
    'metadata': {
        'speaker': 'USER',
        'time': 1695081065.7258203,
        'message': 'Can I make embeddings with pandas?',
        'timestring': 'Monday, September 18, 2023 at 07:51PM ',
        'uuid': '954a51d7-8ac8-4b24-8d56-612e63ff15fb'
    }
}

df = pd.DataFrame([data])
tbl.add(df)

# db.uri, db.table_names()  # Return the database URI and list of table names for verification

